<!--
  If we are allowed to approve:
    - if the task is not claimed, show a claim button
    - if we have claimed the task, show the approval controls (also show delegation controls)
    - if the task is claimed by someone else, show the assignee username

  If we are not allowed to approve:
    - show no controls
-->
<div class="row">

  <div class="col-md-3">
    <span class="label pull-left"
          ng-class="ctrl.parent.getNumValidationErrors() > 0 ? 'bg-red' : 'bg-gray'"
          tooltip="{{ctrl.parent.getNumValidationErrors()}} error(s) found. Click to view details."
          tooltip-placement="right">
      <i class="fa fa-fw fa-exclamation-circle"></i> {{ctrl.parent.getNumValidationErrors()}}
    </span>
  </div>

  <div class="col-md-9">
    <!-- Only show controls when we have permission to approve -->
    <div ng-if="ctrl.parent.isCurrentUserAuthorised()" class="pull-right">

      <!-- Request has been claimed -->
      <div ng-if="ctrl.parent.isCurrentTaskClaimed()">

        <!-- Request has been claimed by us -->
        <div ng-if="ctrl.parent.isCurrentUserAssigned()">
          <div class="btn-group">
            <button class="btn btn-default"
                    ng-click="ctrl.approveSelectedPoints($event)"
                    ng-disabled="!ctrl.parent.getSelectedPointIds().length">
              {{'APPROVE_SELECTED'|translate}}
            </button>

            <button class="btn btn-default"
                    ng-click="ctrl.approveAll($event)">
              Approve all <!--{{'REJECT_ALL'|translate}}-->
            </button>
          </div>

          <div class="btn-group">
            <button class="btn btn-default"
                    ng-click="ctrl.rejectSelectedPoints($event)"
                    ng-disabled="!ctrl.parent.getSelectedPointIds().length">
              {{'REJECT_SELECTED'|translate}}
            </button>

            <button class="btn btn-default"
                    ng-click="ctrl.rejectAll($event)">
              Reject all <!--{{'REJECT_ALL'|translate}}-->
            </button>
          </div>

          <div class="btn-group">
            <!--Button to validate the request-->
            <button class="btn btn-success"
                    ng-click="ctrl.validate($event)"
                    ng-disabled="!ctrl.canValidate() || ctrl.parent.validating == 'started'"
                    tooltip="{{'VALIDATE_REQUEST'|translate}}">

              <!--Show icon based on the loading state-->
              <i class="fa fa-fw fa-check-square-o"       ng-show="ctrl.parent.validating == undefined"></i>
              <i class="fa fa-fw fa-spin fa-cog"          ng-show="ctrl.parent.validating == 'started'"></i>
              <i class="fa fa-fw fa-check-square-o"       ng-show="ctrl.parent.validating == 'success'"></i>
              <i class="fa fa-fw fa-exclamation-triangle" ng-show="ctrl.parent.validating == 'error'"></i>
              {{'VALIDATE'|translate}}
            </button>
          </div>

          <div class="btn-group">
            <!-- Button to submit the request -->
            <button class="btn btn-primary"
                    ng-click="ctrl.submit($event)"
                    ng-disabled="!ctrl.canSubmit() || ctrl.parent.submitting == 'started'"
                    tooltip="{{'SUBMIT_APPROVAL'|translate}}">

              <!--Show icon based on the loading state-->
              <i class="fa fa-fw fa-external-link"        ng-show="ctrl.parent.submitting == undefined"></i>
              <i class="fa fa-fw fa-spin fa-cog"          ng-show="ctrl.parent.submitting == 'started'"></i>
              <i class="fa fa-fw fa-external-link"        ng-show="ctrl.parent.submitting == 'success'"></i>
              <i class="fa fa-fw fa-exclamation-triangle" ng-show="ctrl.parent.submitting == 'error'"></i>
              {{'SUBMIT'|translate}}
            </button>

          </div>
        </div>

        <!-- Request is assigned to someone else -->
        <div ng-if="!ctrl.parent.isCurrentUserAssigned()">
          <div>Request assigned to: <a href="users/{{ctrl.parent.getAssignee()}}" ng-click="$event.stopPropagation();">{{ctrl.parent.getAssignee()}}</a></div>
        </div>

      </div>

      <!-- Request is unclaimed -->
      <div ng-if="!ctrl.parent.isCurrentTaskClaimed()">
        <div class="btn-group">
          <button class="btn btn-primary"
                  ng-click="ctrl.parent.claim($event)">
            Begin approval
          </button>
        </div>
      </div>

    </div>

  </div>

</div>
