<!--
  If we are allowed to approve:
    - if the task is not claimed, show a claim button
    - if we have claimed the task, show the approval controls (also show delegation controls)
    - if the task is claimed by someone else, show the assignee username

  If we are not allowed to approve:
    - show no controls
-->

<div class="pull-right">

  <!-- Only show controls when we have permission to approve -->
  <div ng-if="ctrl.isCurrentUserAuthorised()">

    <!-- Request has been claimed -->
    <div ng-if="ctrl.isCurrentTaskClaimed()">

      <!-- Request has been claimed by us -->
      <div ng-if="ctrl.isCurrentUserAssigned()">
        <div class="btn-group">
          <button class="btn btn-success"
                  ng-click="ctrl.approveSelectedPoints($event)"
                  ng-disabled="!ctrl.parent.getSelectedPointIds().length">
            {{'APPROVE_SELECTED'|translate}}
          </button>

          <button class="btn btn-success"
                  ng-click="ctrl.approveAll($event)">
            Approve all <!--{{'REJECT_ALL'|translate}}-->
          </button>
        </div>

        <div class="btn-group">
          <button class="btn btn-danger"
                  ng-click="ctrl.rejectSelectedPoints($event)"
                  ng-disabled="!ctrl.parent.getSelectedPointIds().length">
            {{'REJECT_SELECTED'|translate}}
          </button>

          <button class="btn btn-danger"
                  ng-click="ctrl.rejectAll($event)">
            Reject all <!--{{'REJECT_ALL'|translate}}-->
          </button>
        </div>

        <div class="btn-group">

          <button class="btn btn-primary"
                  ng-click="ctrl.submit($event)"
                  ng-disabled="!ctrl.canSubmit()"
                  tooltip-append-to-body="true"
                  tooltip="{{'SUBMIT_APPROVAL'|translate}}">

            <!--Show icon based on the loading state-->
            <i class="fa fa-fw fa-external-link"        ng-show="ctrl.submitting == undefined"></i>
            <i class="fa fa-fw fa-spin fa-cog"          ng-show="ctrl.submitting == 'started'"></i>
            <i class="fa fa-fw fa-external-link"        ng-show="ctrl.submitting == 'success'"></i>
            <i class="fa fa-fw fa-exclamation-triangle" ng-show="ctrl.submitting == 'error'"></i>
            {{'SUBMIT'|translate}}
          </button>

        </div>
      </div>

      <!-- Request is assigned to someone else -->
      <div ng-if="!ctrl.isCurrentUserAssigned()">
        <div>Request assigned to: <a href="#/users/{{ctrl.tasks['approve'].assignee}}" ng-click="$event.stopPropagation();">{{ctrl.tasks['approve'].assignee}}</a></div>
      </div>

    </div>

    <!-- Request is unclaimed -->
    <div ng-if="!ctrl.isCurrentTaskClaimed()">
      <div class="btn-group">
        <button class="btn btn-primary"
                ng-click="ctrl.claim($event)">
          Begin approval
        </button>
      </div>
    </div>

  </div>

</div>