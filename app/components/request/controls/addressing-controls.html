<!--
  If we are allowed to address:
    - if the task is not claimed, show a claim button
    - if we have claimed the task, show the addressing controls (also show delegation controls)
    - if the task is claimed by someone else, show the assignee username

  If we are not allowed to address:
    - show no controls
-->

<div class="row">

  <div class="col-md-3">
    <span class="label pull-left"
          ng-class="ctrl.parent.getNumValidationErrors() > 0 ? 'bg-red' : 'bg-gray'"
          tooltip="{{ctrl.parent.getNumValidationErrors()}} error(s) found. Click to view details."
          tooltip-placement="right">
      <i class="fa fa-fw fa-exclamation-circle"></i> {{ctrl.parent.getNumValidationErrors()}}
    </span>
  </div>

  <div class="col-md-9">
    <!-- Only show controls when we have permission to address -->
    <div ng-if="ctrl.parent.isCurrentUserAuthorised()" class="pull-right">

      <!-- Request has been claimed -->
      <div ng-if="ctrl.parent.isCurrentTaskClaimed()">

        <!-- Request has been claimed by us -->
        <div ng-if="ctrl.parent.isCurrentUserAssigned()">

          <!--<div class="btn-group">-->
            <!--<button class="btn btn-danger"  ng-click="ctrl.rejectRequest($event)" translate>Reject request</button>-->
          <!--</div>-->

          <div class="btn-group">
            <!--Button to validate the request-->
            <button class="btn btn-success"
                    ng-click="ctrl.parent.validate($event)"
                    ng-disabled="!ctrl.parent.canValidate() || ctrl.parent.validating == 'started'"
                    tooltip-append-to-body="true"
                    tooltip="{{'VALIDATE_REQUEST'|translate}}">

              <!--Show icon based on the loading state-->
              <i class="fa fa-fw fa-check-square-o"       ng-show="ctrl.parent.validating == undefined"></i>
              <i class="fa fa-fw fa-spin fa-cog"          ng-show="ctrl.parent.validating == 'started'"></i>
              <i class="fa fa-fw fa-check-square-o"       ng-show="ctrl.parent.validating == 'success'"></i>
              <i class="fa fa-fw fa-exclamation-triangle" ng-show="ctrl.parent.validating == 'error'"></i>
              {{'VALIDATE'|translate}}
            </button>
          </div>

          <div class="btn-group">

            <button class="btn btn-primary"
                    ng-click="ctrl.submit($event)"
                    ng-disabled="!ctrl.parent.canSubmit() ctrl.parent.submitting == 'started'"
                    tooltip-append-to-body="true"
                    tooltip="{{ 'SUBMIT_ADDRESSING' | translate}}">

              <!--Show icon based on the loading state-->
              <i class="fa fa-fw fa-external-link"        ng-show="ctrl.parent.submitting == undefined"></i>
              <i class="fa fa-fw fa-spin fa-cog"          ng-show="ctrl.parent.submitting == 'started'"></i>
              <i class="fa fa-fw fa-external-link"        ng-show="ctrl.parent.submitting == 'success'"></i>
              <i class="fa fa-fw fa-exclamation-triangle" ng-show="ctrl.parent.submitting == 'error'"></i>
              {{ 'SUBMIT' | translate}}
            </button>

          </div>
        </div>

        <!-- Request is assigned to someone else -->
        <div ng-if="!ctrl.parent.isCurrentUserAssigned()">
          <div>Request assigned to: <a href="users/{{ctrl.parent.getAssignee()}}" ng-click="$event.stopPropagation();">{{ctrl.parent.getAssignee()}}</a></div>
        </div>

      </div>

      <!-- Request is unclaimed -->
      <div ng-if="!ctrl.parent.isCurrentTaskClaimed()">
        <div class="btn-group">
          <button class="btn btn-primary"
                  ng-click="ctrl.parent.claim($event)">
            Begin addressing
          </button>
        </div>
      </div>

    </div>

  </div>

</div>
