<style>
  .content-header > .request-title {
    padding-left: 5px;
  }

  .content-header > .request-title > .request-details {
    margin-top:10px;
  }

  .content-header > .request-title > .request-details > .request-detail-item {
    margin-left:10px;
  }

  .content-header > .request-title h1 {
    margin: 0;
  }

  .content-header > .request-icon h1 {
    margin: 0;
  }

  div.details {
    width: 100%;
    display: table;
    content: " ";
    clear: both;
    margin-bottom: 20px;
  }

  div.details div.details-header {
    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAADCAYAAABS3WWCAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NEQ5RDgxQzc2RjQ5MTFFMjhEMUNENzFGRUMwRjhBRTciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NEQ5RDgxQzg2RjQ5MTFFMjhEMUNENzFGRUMwRjhBRTciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo0RDlEODFDNTZGNDkxMUUyOEQxQ0Q3MUZFQzBGOEFFNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo0RDlEODFDNjZGNDkxMUUyOEQxQ0Q3MUZFQzBGOEFFNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvXFWFAAAAAYSURBVHjaYvj//z8D0/Pnz/8zgFgAAQYAS5UJscReGMIAAAAASUVORK5CYII=) repeat-x scroll 0 17px;
  }

  div.details div.details-header > h5 {
    background-color: #fff;
    display: inline-block;
    padding-right: 5px;
    font-weight: bold;
  }

  div.details div.property-list > span {
    margin-top: 1px;
  }

  li > a.new-tab {
    border-top: 1px dashed #ccc !important;
    border-right: 1px dashed #ccc !important;
    border-left: 1px;
    border-bottom: 1px !important;
    border-top-right-radius: 5px;
    border-top-left-radius: 0;
    padding: 4px 10px 3px;
  }

  li > a.new-tab:hover, li > a.new-tab:focus {
    background: #EEEEEE;
    border-top: 1px solid #CCC !important;
    border-right: 1px solid #CCC !important;
    border-left: 1px;
    border-bottom: 1px !important;
  }

  li > ul.new-tab-menu {
    margin-top: 1px !important;
    margin-left: -1px;
  }

  .pagination > li > a {
    background: #fafafa;
    color: #666;
  }

  .pagination > .active > a,
  .pagination > .active > span,
  .pagination > .active > a:hover,
  .pagination > .active > span:hover,
  .pagination > .active > a:focus,
  .pagination > .active > span:focus {
    color: #333;
    background-color: #E6E6E6;
    border-color: #ADADAD;
    box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125);
  }

  .alert-success {
    color: #3C763D !important;
    background-color: #DFF0D8 !important;
    border-color: #D6E9C6 !important;
  }

  .alert-danger {
    color: #A94442 !important;
    background-color: #F2DEDE !important;
    border-color: #EBCCD1 !important;
  }
</style>

<style>

  .toolbar-wrapper {
    margin-bottom: 15px;
  }

  /** Remove the border from the bottom of the category tabs */
  .nav-tabs {
    border-bottom: none;
  }

  .table-wrapper {
    /** Make the table fill the entire width  */
    margin-left: -15px;
    margin-right: -15px;
    margin-bottom: -15px;
    border-bottom: 1px solid #ccc;
  }

  /** Remove shadow from column headers */
  .handsontable .handsontable:not(.ht_master) table {
    -webkit-box-shadow: none;
    box-shadow: none;
    border-bottom:1px solid #ccc;
  }

  /** Make striped rows */
  .handsontable table > tbody > tr:nth-child(2n) > td {
    background-color: #f9f9f9;
  }
  .handsontable table > tbody > tr:nth-child(2n+1) > td {
    background-color: #fff;
  }

</style>

<div class="content-wrapper">

<!-- Content Header (Page header) -->
<section id="request-header" class="content-header">
<!--   <h1>
    <i class="fa fa-list-ol fa-fw text-muted" style="vertical-align: middle;"></i>
    requests <span class="text-muted">/</span> {{ctrl.request.requestId}} <small>{{ctrl.request.description}}</small>
  </h1> -->

  <div class="request-title" style="display: inline-block">
    <h1 class="pull-left">
      <i class="fa fa-list-ol fa-fw text-muted" style="vertical-align: middle;"></i>
      requests <span class="text-muted">/</span> {{::ctrl.request.requestId}}
    </h1>

    <div class="request-details pull-right">
      <!-- <span class="text-muted">
        {{ctrl.request.type | uppercase}}
      </span> -->
      <span class="request-detail-item text-muted">
        <i class="fa fa-fw fa-sitemap"></i>
        {{::ctrl.request.subsystem.name}}
      </span>
      <span class="request-detail-item text-muted">
        <i class="fa fa-fw fa-crosshairs"></i>
        {{::ctrl.request.domain}}
      </span>
      <span class="request-detail-item text-muted">
        <i class="fa fa-fw fa-cogs"></i>
        {{::ctrl.request.categories.join(', ')}}
      </span>
      <span class="request-detail-item text-muted">
        <i class="fa fa-fw fa-user"></i>
        {{::ctrl.request.creator.username}}
      </span>
      <span class="label request-status" style="margin-left: 10px !important;" ng-class="'{{::ctrl.request.status}}'">{{::ctrl.request.status.replace('_', ' ')}}</span>
    </div>
  </div>
  <div>
    <h1 style="margin: 0;margin-left: 10px;"><small>{{::ctrl.request.description}}</small></h1>
  </div>

  <div id="request-main-nav">
    <tabset justified="false">
      <tab ng-click="ctrl.activateTab(0)">
        <tab-heading> <i class="fa fa-fw fa-edit"></i>Edit</tab-heading>
      </tab>
      <tab ng-click="ctrl.activateTab(1)">
        <tab-heading> <i class="fa fa-fw fa-exclamation-triangle"></i>Error report</tab-heading>
      </tab>
      <tab ng-click="ctrl.activateTab(2)">
        <tab-heading> <i class="fa fa-fw fa-heartbeat"></i>Activity</tab-heading>
      </tab>
      <tab ng-click="ctrl.activateTab(3)">
        <tab-heading><i class="fa fa-fw fa-comments"></i>Comments</tab-heading>
      </tab>
    </tabset>
  </div>

</section>

<!-- Main content -->
<section class="content">

  <!-- Request editing page -->
  <div ng-show="ctrl.currentActiveTab == 0">


    <!-- Alerts are shown here -->
    <alert ng-repeat="alert in alerts"
           type="{{alert.type}}"
           close="alert.close()">
      {{alert.message}}
    </alert>


    <!-- If this is a parent request, list its children -->
    <div class="details" ng-if="ctrl.children.length > 0">
      children:
      <div ng-repeat="child in ctrl.children">
        <a href="#/requests/{{child.requestId}}">{{::child.requestId}}</a> {{::child.status}}
      </div>
    </div>


    <!-- If this is a child request, reference its parent -->
    <div class="details" ng-if="ctrl.request.parentRequestId">
      parent: <a href="#/requests/{{ctrl.request.parentRequestId}}">{{::ctrl.request.parentRequestId}}</a>
    </div>



    <div class="toolbar-wrapper" style="height:34px;">

        <!-- Button to save the request -->
        <button class="btn btn-default" ng-click="ctrl.save()"  tooltip-append-to-body="true" tooltip="Save request">
          <i class="fa fa-fw fa-save saving-state"></i>

          <!-- Saving state indicators -->
          <span ng-show="$root.saving == 'started'">
            <i class="fa fa-fw fa-spin fa-cog saving-state"></i>
          </span>
          <span ng-show="$root.saving == 'success'">
            <i class="fa fa-fw fa-check saving-state text-success"></i>
          </span>
          <span ng-show="$root.saving == 'error'">
            <i class="fa fa-fw fa-exclamation-triangle saving-state text-danger"></i>
          </span>
        </button>

        <!-- Button to reset column sorting -->
        <button class="btn btn-default" ng-click="ctrl.resetSorting()" tooltip-append-to-body="true" tooltip="Reset sorting">
          <span class="glyphicon glyphicon-erase"></span>
        </button>

        <!-- Undo/redo buttons -->
        <div class="btn-group">
          <button class="btn btn-default" tooltip-append-to-body="true" tooltip="Undo">
            <i class="fa fa-fw fa-undo"></i>
          </button>
          <button class="btn btn-default" tooltip-append-to-body="true" tooltip="Redo">
            <i class="fa fa-fw fa-repeat"></i>
          </button>
        </div>

        <!-- Show appropriate extra controls based on the request status -->
        <span ng-switch="ctrl.request.status">
          <span ng-switch-when="IN_PROGRESS">
            <creation-controls></creation-controls>
          </span>
          <span ng-switch-when="FOR_CORRECTION">
            <creation-controls></creation-controls>
          </span>
          <span ng-switch-when="FOR_APPROVAL">
            <approval-controls></approval-controls>
          </span>
          <span ng-switch-when="FOR_ADDRESSING">
            <addressing-controls></addressing-controls>
          </span>
          <span ng-switch-when="FOR_CABLING">
            <cabling-controls></cabling-controls>
          </span>
          <span ng-switch-when="FOR_TESTING">
            <testing-controls></testing-controls>
          </span>
        </span>

        <!-- Search form -->
        <form class="navbar-form navbar-right sidebar-form" style="margin-top: 0;">
          <div class="form-group input-group">
            <input type="text" name="q" ng-model="q" class="form-control" placeholder="Search...">
            <span class="input-group-btn">
              <button type="submit" name="search" id="search-btn" class="btn btn-flat navbar-btn" ng-click="ctrl.search(q)">
                <i class="fa fa-search"></i>
              </button>
            </span>
          </div>
        </form>

    </div>
    <div class="clearfix"></div>


    <div class="nav-tabs" style="height:28px">
      <!-- Create a new tab for each category -->
      <tabset class="category-headings">
        <!-- Categories are only shown if they are enabled for the current workflow state -->
        <tab ng-repeat="category in ctrl.schema.categories | enabled:ctrl.request.status track by category.name"
             heading="{{::category.name}}"
             select="ctrl.activateCategory(category)"
             class="category-heading"></tab>

        <!-- Button to dynamically add a new tab category -->
        <li dropdown ng-show="::ctrl.request.status == 'IN_PROGRESS'">
          <a dropdown-toggle class="new-tab dropdown-toggle" href="">
            <i class="fa fa-plus-square-o"></i>
          </a>
          <ul class="new-tab-menu dropdown-menu" role="menu">
            <li ng-repeat="tab in ctrl.availableCategories">
              <a ng-click="ctrl.addNewCategory(tab)">{{::tab}}</a>
            </li>
            <li ng-show="ctrl.availableCategories.length == 0" class="dropdown-header">
              No categories available
            </li>
          </ul>
        </li>
      </tabset>
    </div>



    <div id="table-wrapper" class="table-wrapper" style="height: 600px; overflow: hidden">
      <hot-table id="table" settings="ctrl.settings"
                 datarows="ctrl.request.points"
                 columns="ctrl.columns">
      </hot-table>
    </div>


  </div>

  <!-- Request error report page -->
  <div ng-show="ctrl.currentActiveTab == 1">
    <div ng-include src="'components/request/error-report.html'"></div>
  </div>

  <!-- Request activity page -->
  <div ng-show="ctrl.currentActiveTab == 2">
    <div ng-include src="'components/request/activity.html'"></div>
  </div>

  <!-- Request comments page -->
  <div ng-show="ctrl.currentActiveTab == 3">
    <div ng-include src="'components/request/comments.html'"></div>
  </div>


</section>
<!-- /.content -->

</div>
<!-- /.content-wrapper -->
    
<footer class="main-footer">
  <div class="pull-right hidden-xs">modesti v0.1</div>
  <div>&nbsp;</div>
</footer>