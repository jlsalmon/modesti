
<section class="request-header container-fluid">
  <div class="row">
    <div class="col-lg-12">

      <div class="pull-left">
        <h4 class="request-id">
          <i class="fa fa-list-ol fa-fw text-muted"></i>
          {{ 'REQUESTS' | translate | lowercase }} <span class="text-muted">/</span> {{::ctrl.request.requestId}}
          <small class="request-description">{{::ctrl.request.description}}</small>
        </h4>
      </div>

      <div class="pull-right">

        <span class="request-detail-item text-muted" tooltip="{{'CREATOR'|translate}}" tooltip-append-to-body="true" tooltip-placement="bottom">
          <i class="fa fa-fw fa-user-md"></i>
          <a href="#/users/{{ctrl.request.creator.username}}">{{::ctrl.request.creator.username}}</a>
        </span>

        <!-- <span class="text-muted">
        {{ctrl.request.type | uppercase}}
        </span> -->
        <span class="request-detail-item text-muted" tooltip="{{'DOMAIN'|translate}}" tooltip-append-to-body="true" tooltip-placement="bottom">
          <i class="fa fa-fw fa-crosshairs"></i>
          {{::ctrl.request.domain}}
        </span>
        <span class="request-detail-item text-muted" tooltip="{{'SYSTEM_SUBSYSTEM'|translate}}" tooltip-append-to-body="true" tooltip-placement="bottom">
          <i class="fa fa-fw fa-sitemap"></i>
          {{::ctrl.request.subsystem}}
        </span>

        <!--If this is a child request, reference its parent-->
        <span class="request-detail-item" ng-if="ctrl.request.parentRequestId">
           {{'PARENT'|translate}}: <a href="#/requests/{{ctrl.request.parentRequestId}}">{{::ctrl.request.parentRequestId}}</a>
        </span>

        <!--If this is a parent request, list its children-->
        <span class="request-detail-item" ng-if="ctrl.children.length > 0">
           {{'CHILDREN'|translate}}:
          <span ng-repeat="child in ctrl.children">
            <a href="#/requests/{{child.requestId}}">{{::child.requestId}}</a>
          </span>
        </span>

        <span class="request-detail-item"  tooltip="{{'STATUS'|translate}}" tooltip-append-to-body="true" tooltip-placement="bottom">
          <span class="label request-status" ng-class="'{{::ctrl.request.status}}'">
            {{::ctrl.request.status.replace('_', ' ')}}
          </span>
        </span>

      </div>

    </div>
  </div>
</section>

<!-- Alerts are shown here -->
<div class="alert-messages">
  <alert ng-repeat="alert in alerts"
         type="{{alert.type}}"
         close="alert.close()">
    <span ng-bind-html="alert.message"></span>
  </alert>
</div>


<section class="toolbar container-fluid">

  <div class="row">
    <div class="col-lg-12">

      <div class="pull-left request-category-selector">
        <!-- Dropdown button to select category -->
        <div class="btn-group toolbar-item" dropdown>
          <button type="button" class="btn btn-sm btn-default dropdown-toggle" dropdown-toggle>
            <span class="text-muted">{{'CATEGORY'|translate}}:</span>
            {{ctrl.activeCategory.name_en}} <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li ng-repeat="category in ctrl.schema.categories"
                ng-click="ctrl.activateCategory(category)">
              <a>
                <i ng-if="category.valid === false" class="fa fa-exclamation-triangle text-danger"></i>{{::category.name_en}}
              </a>
            </li>

            <li class="divider"></li>

            <!-- Only show datasource if it has been selected as point type for at least one point -->
            <li ng-repeat="datasource in ctrl.schema.datasources | active:ctrl.request"
                ng-click="ctrl.activateCategory(datasource)">
              <a>
                <i ng-if="datasource.valid === false" class="fa fa-exclamation-triangle text-danger"></i>{{::datasource.name_en}}
              </a>
            </li>
          </ul>
        </div>

      </div>


      <!-- Button to save the request -->
      <button class="btn btn-sm btn-default toolbar-item" ng-click="ctrl.save()" tooltip-append-to-body="true" tooltip="{{'SAVE'|translate}}">
        <i class="fa fa-fw fa-save saving-state"></i>

        <!-- Saving state indicators -->
        <span ng-show="$root.saving == 'started'">
          <i class="fa fa-fw fa-spin fa-cog saving-state"></i>
        </span>
        <span ng-show="$root.saving == 'success'">
          <i class="fa fa-fw fa-check saving-state text-success"></i>
        </span>
        <span ng-show="$root.saving == 'error'">
          <i class="fa fa-fw fa-exclamation-triangle saving-state text-danger"></i>
        </span>
      </button>


      <!-- Button to reset column sorting -->
      <!-- <button class="btn btn-sm btn-default toolbar-item" ng-click="ctrl.resetSorting()" tooltip-append-to-body="true"
              tooltip="{{'RESET_SORTING'|translate}}">
        <span class="glyphicon glyphicon-erase"></span>
      </button> -->

      <!-- Undo/redo buttons -->
      <div class="btn-group">
        <a class="btn btn-sm btn-default" ng-click="ctrl.undo()" ng-disabled="!ctrl.hot.isUndoAvailable()" tooltip-append-to-body="true" tooltip="{{'UNDO'|translate}}">
          <i class="fa fa-fw fa-undo"></i>
        </a>
        <a class="btn btn-sm btn-default" ng-click="ctrl.redo()" ng-disabled="!ctrl.hot.isRedoAvailable()" tooltip-append-to-body="true" tooltip="{{'REDO'|translate}}">
          <i class="fa fa-fw fa-repeat"></i>
        </a>
      </div>


      <!-- Cut/copy/paste buttons -->
      <div class="btn-group toolbar-item">
        <button class="btn btn-sm btn-default" ng-click="ctrl.cut()" tooltip-append-to-body="true" tooltip="{{'CUT'|translate}}">
          <i class="fa fa-fw fa-scissors"></i>
        </button>
        <button class="btn btn-sm btn-default" ng-click="ctrl.copy()" tooltip-append-to-body="true" tooltip="{{'COPY'|translate}}">
          <i class="fa fa-fw fa-copy"></i>
        </button>
        <button class="btn btn-sm btn-default" ng-click="ctrl.paste()" tooltip-append-to-body="true" tooltip="{{'PASTE'|translate}}">
          <i class="fa fa-fw fa-paste"></i>
        </button>
      </div>


      <!-- Expand/contract table buttons -->
      <!--<button class="btn btn-sm btn-default toolbar-item" data-toggle="button">-->
        <!--<i class="fa fa-fw fa-expand" ng-if="ctrl.tableExpanded === true" ng-click="ctrl.toggleTableStretch()"></i>-->
        <!--<i class="fa fa-fw fa-compress" ng-if="ctrl.tableExpanded === false" ng-click="ctrl.toggleTableStretch()"></i>-->
      <!--</button>-->

      <!-- Assignment button -->
      <button class="btn btn-sm btn-default toolbar-item" ng-click="ctrl.assignTask()" tooltip-append-to-body="true" tooltip="Set Assignee" style="margin-left: 20px;">
        <i class="fa fa-fw fa-user"></i>
        Assignee:
        <span ng-if="!ctrl.getAssignee()">none</span>
        <span ng-if="ctrl.getAssignee()"><a href="">{{ctrl.getAssignee()}}</a></span>
      </button>

      <div class="pull-right">

        <!-- Comments button -->
        <button class="btn btn-sm toolbar-item" ng-click="ctrl.showComments()" tooltip-append-to-body="true" tooltip="{{'COMMENTS'|translate}}"
                ng-class="ctrl.request.comments.length > 0 ? 'btn-danger' : 'btn-default'">
          <i class="fa fa-fw fa-comments"></i>
          {{ctrl.request.comments.length}}
        </button>

        <!-- History button -->
        <button class="btn btn-sm btn-default toolbar-item" ng-click="ctrl.showHistory()" tooltip-append-to-body="true" tooltip="{{'HISTORY'|translate}}">
          <i class="fa fa-fw fa-history"></i>
        </button>

        <!-- Help button -->
        <button class="btn btn-sm btn-default toolbar-item" ng-click="ctrl.showHelp()" tooltip-append-to-body="true" tooltip="{{'HELP'|translate}}">
          <i class="fa fa-fw fa-question-circle"></i> Help
        </button>


        <!-- Search form -->
        <!--<form class="search-form toolbar-item form-inline pull-right">-->
          <!--<div class="form-group input-group">-->
            <!--<input type="text" name="query" ng-model="query" class="form-control input-sm" placeholder="{{'THIS_REQUEST'|translate}}">-->
            <!--<span class="input-group-btn">-->
              <!--<button type="submit" name="search" id="search-btn" class="btn btn-sm btn-flat" ng-click="ctrl.search(query)">-->
                <!--<i class="fa fa-search"></i>-->
              <!--</button>-->
            <!--</span>-->
          <!--</div>-->
        <!--</form>-->
      </div>

    </div>
  </div>
</section>



<section class="table" style="overflow: hidden; height: 600px;" ng-cloak>
  <hot-table id="table" settings="ctrl.settings"
             datarows="ctrl.rows"
             columns="ctrl.columns">
  </hot-table>
</section>



<footer class="footer">
  <div class="container-fluid">

    <!-- Show appropriate extra controls based on the request status -->
    <span ng-switch="ctrl.request.status">
      <span ng-switch-when="IN_PROGRESS">
        <creation-controls></creation-controls>
      </span>
      <span ng-switch-when="FOR_CORRECTION">
        <creation-controls></creation-controls>
      </span>
      <span ng-switch-when="FOR_APPROVAL">
        <approval-controls></approval-controls>
      </span>
      <span ng-switch-when="FOR_ADDRESSING">
        <addressing-controls></addressing-controls>
      </span>
      <span ng-switch-when="FOR_CABLING">
        <cabling-controls></cabling-controls>
      </span>
      <span ng-switch-when="FOR_CONFIGURATION">
        <config-controls></config-controls>
      </span>
      <span ng-switch-when="FOR_TESTING">
        <testing-controls></testing-controls>
      </span>
    </span>

  </div>
</footer>
