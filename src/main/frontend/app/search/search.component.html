<style>

  .table-wrapper {
    overflow-y: scroll;
  }

  .table-wrapper .table {
    border-bottom: none;
  }

  .table-wrapper .table th {
    background-color: #EEE;
    border: 1px solid #CCC;
    font-weight: normal;
    text-align: center;
    padding: 0;
    height: 25px;
    vertical-align: middle;
    color: #222;
  }

  .table-wrapper .table > thead:first-child > tr:first-child > th {
    border-top: 1px solid #CCC;
  }

  .table-wrapper .table td.cell-container {
    border: 1px solid #CCC;
    /*height: 24px;*/
    empty-cells: show;
    line-height: 21px;
    padding: 0 4px 0 4px;
  }

  .table-wrapper .table td.cell-container > div {
    /*height: 24px;*/
    overflow: hidden;
    height: 100%;
    width: 100%;
  }

  .pagination {
    margin: 0;
    padding-top: 9px;
  }

  .loading-overlay {
    position: absolute;
    top: 90px;
    width: 100%;
    height: 90%;
    background-color: rgba(255, 255, 255, 0.7);
  }

  .loading-overlay i {
    position: absolute;
    width: 100%;
    top: 46.5%;
    text-align: center;
    vertical-align: middle;
  }
</style>

<!--<aside class="main-sidebar">-->
<!--<section class="sidebar" style="height: auto;">-->

<!--<ul class="sidebar-menu">-->
<!--<li class="treeview active">-->
<!--<a href="#">-->
<!--<i class="fa fa-filter"></i> <span>My Filters</span> <i class="fa fa-angle-left pull-right"></i>-->
<!--</a>-->
<!--<ul class="treeview-menu menu-open" style="display: block;">-->

<!--<li>-->
<!--<a href="">-->
<!--No filters-->
<!--</a>-->
<!--</li>-->

<!--</ul>-->
<!--</li>-->
<!--</ul>-->

<!--</section>-->
<!--</aside>-->


<!-- Alerts are shown here -->
<div class="alert-messages">
  <div uib-alert ng-repeat="alert in $root.alerts"  ng-class="'alert-' + (alert.type || 'warning')" close="alert.close()">
    <span ng-bind-html="alert.message"></span>
  </div>
</div>


<section class="request-header container-fluid">
  <div class="row">
    <div class="col-lg-12">

      <div class="pull-left">
        <h4 class="request-id">
          <i class="fa fa-search fa-fw text-muted" style="vertical-align: baseline;"></i>
          Search for points
        </h4>
      </div>

      <div class="pull-right">


      </div>

    </div>
  </div>
</section>


<section class="toolbar container-fluid">
  <div class="row">
    <div class="col-lg-12">

      <form class="form-inline pull-right">

        <div class="btn-group" uib-dropdown>
          <button type="button" class="btn btn-sm btn-default" uib-dropdown-toggle>
            <i class="fa fa-fw fa-crosshairs"></i>
            Domain: {{$ctrl.schema.id}} <span class="caret"></span>
          </button>
          <ul uib-dropdown-menu role="menu">
            <li ng-repeat="domain in $ctrl.domains">
              <a href="" ng-click="$ctrl.useDomain(domain)">{{domain}}</a>
            </li>
          </ul>
        </div>

        <!-- Dropdown button to select category -->
        <div class="btn-group" uib-dropdown>
          <button type="button" class="btn btn-sm btn-default dropdown-toggle" uib-dropdown-toggle>
            <span class="text-muted">category:</span>
            {{$ctrl.activeCategory.name}} <span class="caret"></span>
          </button>
          <ul uib-dropdown-menu class="dropdown-menu-right">
            <li ng-repeat="category in $ctrl.schema.categories"
                ng-click="$ctrl.activateCategory(category)">
              <a href="">
                    <span>{{::category.name}}
                    <i ng-if="category.valid === false" class="fa fa-exclamation-triangle text-danger pull-right" style="margin-top: 4px;"></i></span>
              </a>
            </li>

            <li class="divider"></li>

            <li ng-repeat="datasource in $ctrl.schema.datasources"
                ng-click="$ctrl.activateCategory(datasource)">
              <a href="">
                    <span>{{::datasource.name}}
                    <i ng-if="datasource.valid === false" class="fa fa-exclamation-triangle text-danger pull-right" style="margin-top: 4px;"></i></span>
              </a>
            </li>
          </ul>
        </div>


      </form>


      <form class="form-inline pull-left">

        <!-- Custom styles for angular-ui-select -->
        <style>
          .ui-select-multiple.ui-select-bootstrap {
            padding: 0;
            min-width: 300px;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-match-item {
            margin: 0;
            padding-top: 0;
            padding-bottom: 0;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-match-item:active {
            box-shadow: none;
          }

          .ui-select-match-item span.selected-field-name {
            padding-right: 5px;
            vertical-align: middle;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-match-item input {
            border: 0;
            border-left: 1px solid #d2d6de;
            height: 28px;
            padding: 0 5px;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-match-item input:focus {
            border-color: #d2d6de !important;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-match-item select {
            padding: 0 2px;
            border: 0;
            border-left: 1px solid #d2d6de;
            height: 28px;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-match-item select:focus {
            border-color: #d2d6de !important;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-match .close {
            padding-top: 7px;
            margin-left: 4px;
            margin-right: -4px;
          }

          .ui-select-multiple.ui-select-bootstrap .ui-select-choices {
            max-height: 500px;
          }
        </style>

        <!-- Custom template for angular-ui-select -->
        <script type="text/ng-template" id="bootstrap/select-multiple.tpl.html">
          <div class="ui-select-container ui-select-multiple ui-select-bootstrap dropdown pull-left" ng-class="{open: $select.open}">
            <div>
              <div class="ui-select-match"></div>

              <button class="btn btn-default btn-sm" ng-click="$select.activate()">
                <i class="fa fa-plus"></i> Add filter
              </button>

              <input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" class="ui-select-search input-xs"
                     placeholder="{{$selectMultiple.getPlaceholder()}}" ng-disabled="$select.disabled" ng-hide="true" ng-click="$select.activate()"
                     ng-model="$select.search" role="combobox" aria-label="{{ $select.baseTitle }}" ondrop="return false;"></div>

            <div class="ui-select-choices"></div>
            <div class="ui-select-no-choice"></div>
          </div>
        </script>


        <!-- Custom template for angular-ui-select -->
        <script type="text/ng-template" id="bootstrap/match-multiple.tpl.html">
          <span class="ui-select-match">
            <span ng-repeat="$item in $select.selected">
              <span class="ui-select-match-item btn btn-default btn-sm" tabindex="-1"
                    type="button" ng-disabled="$select.disabled"
                    ng-click="$selectMultiple.activeMatchIndex = $index;"
                    ng-class="{'select-locked':$select.isLocked(this, $index)}"
                    ui-select-sort="$select.selected">
                <span class="close ui-select-match-close" ng-hide="$select.disabled" ng-click="$selectMultiple.removeChoice($index)">&times;</span>
                <span uis-transclude-append=""></span>
              </span>
            </span>
          </span>
        </script>

        <div class="btn-group" ng-if="$ctrl.schema">
          <ui-select multiple ng-model="$ctrl.filters" theme="bootstrap" on-remove="$ctrl.onFilterRemoved($item, $model)">

            <ui-select-match allow-clear="true">

              <span class="selected-field-name">
                {{$item.name}}
              </span>


              <span ng-if="$item.type === 'text'">
                <input type="text"
                       class="form-control input-xs"
                       ng-model="$ctrl.filters[$ctrl.filters.indexOf($item)].value"
                       ng-change="$ctrl.search()">
              </span>
              <span ng-if="$item.type === 'numeric'">
                <input type="number"
                       class="form-control input-xs"
                       ng-model="$ctrl.filters[$ctrl.filters.indexOf($item)].value"
                       ng-change="$ctrl.search()">
              </span>
              <span ng-if="$item.type === 'options'">
                <select class="form-control input-xs"
                        ng-options="$ctrl.getOptionValue(option) as $ctrl.getOptionDisplayValue(option) for option in $item.options"
                        ng-model="$ctrl.filters[$ctrl.filters.indexOf($item)].value"
                        ng-change="$ctrl.search()">
                  <option value=""></option>
                </select>
              </span>
              <span ng-if="$item.type === 'autocomplete'">
                <input type="text" class="form-control input-xs" autocomplete="off" placeholder="Type to search..."
                       ng-model="$ctrl.filters[$ctrl.filters.indexOf($item)].value"
                       uib-typeahead="($item.model ? item[$item.model] : item.value) for item in $ctrl.queryFieldValues($item, $viewValue)"
                       typeahead-on-select="$ctrl.search()"
                       typeahead-min-length="$item.minLength"
                       typeahead-append-to-body="true">
              </span>


            </ui-select-match>

            <ui-select-choices repeat="field in $ctrl.getAllFields()" group-by="'category'">
              <div ng-bind-html="field.name | highlight: $select.search"></div>
            </ui-select-choices>

          </ui-select>
        </div>

      </form>

    </div>
  </div>
</section>

<!---->
<div class="loading-overlay" ng-if="$ctrl.loading == 'started' || $ctrl.loading == 'error'">
  <span us-spinner ng-if="$ctrl.loading === 'started'"></span>
  <i class="fa fa-3x fa-exclamation-triangle" ng-if="$ctrl.loading === 'error'"></i>
</div>


<section class="table">
  <div class="table-wrapper">
    <table class="table table-bordered table-hover table-condensed">
      <thead>
      <tr>
        <th ng-repeat="field in $ctrl.activeCategory.fields">
<!--            uib-popover-template="'filter-popover-template.html'"
            popover-trigger="'outsideClick'"
            popover-append-to-body="true">-->
          {{field.name}} <!--<i class="fa fa-filter text-muted"></i>-->
        </th>

<!--        <script type="text/ng-template" id="filter-popover-template.html">
          <div>{{dynamicPopover.content}}</div>
          <div class="form-group">
            <label>Popup Title:</label>
            <input type="text" ng-model="dynamicPopover.title" class="form-control">
          </div>
        </script>-->
      </tr>

      <!--<tr>-->
      <!--<th ng-repeat="field in $ctrl.activeCategory.fields">-->
      <!--<div ng-if="field.type === 'text'">-->
      <!--<input type="text" class="form-control input-sm" ng-model="$ctrl.filters[field.id].value" ng-change="$ctrl.search()">-->
      <!--</div>-->

      <!--<div ng-if="field.type === 'numeric'">-->
      <!--<input type="number" class="form-control input-sm" ng-model="$ctrl.filters[field.id].value" ng-change="$ctrl.search()">-->
      <!--</div>-->

      <!--<div ng-if="field.type === 'options'">-->

      <!--<select class="form-control input-sm"-->
      <!--ng-options="$ctrl.getOptionValue(option) as-->
      <!--$ctrl.getOptionDisplayValue(option)-->
      <!--for option in field.options"-->
      <!--ng-model="$ctrl.filters[field.id].value"-->
      <!--ng-change="$ctrl.search()">-->
      <!--<option value=""></option>-->
      <!--</select>-->

      <!--</div>-->

      <!--<div ng-if="field.type === 'autocomplete'">-->

      <!--<input type="text" class="form-control input-sm" autocomplete="off" placeholder="Type to search..."-->
      <!--ng-model="$ctrl.filters[field.id].value"-->
      <!--typeahead="(field.model ? item[field.model] : item.value) for item in $ctrl.queryFieldValues(field, $viewValue)"-->
      <!--typeahead-on-select="$ctrl.search()"-->
      <!--typeahead-min-length="field.minLength"-->
      <!--typeahead-append-to-body="true">-->

      <!--</div>-->
      <!--</th>-->
      <!--</tr>-->
      </thead>

      <tbody>
      <tr ng-repeat="point in $ctrl.points">
        <td ng-repeat="field in $ctrl.activeCategory.fields" class="cell-container">

          <div ng-if="field.type === 'autocomplete'">
            <div ng-if="field.model">
              {{point.properties[field.id][field.model]}}
            </div>
            <div ng-if="!field.model">
              {{point.properties[field.id].value}}
            </div>
          </div>

          <div ng-if="field.type !== 'autocomplete'">
            {{point.properties[field.id]}}
          </div>

          <div ng-if="point.properties[field.id] == null ||
                             point.properties[field.id] == undefined ||
                             point.properties[field.id] == ''">
            &nbsp;
          </div>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</section>


<footer class="footer">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <form class="form-inline">

          <div class="form-group" ng-if="$ctrl.points.length > 0">
            <div uib-pagination boundary-links="true"
                 max-size="5"
                 total-items="$ctrl.page.totalElements"
                 items-per-page="$ctrl.page.size"
                 rotate="false"
                 ng-model="$ctrl.page.number"
                 ng-change="$ctrl.onPageChanged()"
                 class="pagination-sm"
                 previous-text="&lsaquo;"
                 next-text="&rsaquo;"
                 first-text="&laquo;"
                 last-text="&raquo;"></div>
          </div>

          <div class="form-group">
            <span ng-if="$ctrl.page.totalElements" style="padding: 10px; vertical-align: middle;">
              page {{$ctrl.page.number}} of {{$ctrl.page.totalPages}} &middot; {{$ctrl.page.totalElements}} points in total for this filter
            </span>
          </div>


          <div class="pull-right">

            <!-- "Update points" button -->
            <div class="form-group">
              <button class="btn btn-sm btn-warning pull-right" ng-click="$ctrl.updatePoints()">
                <i class="fa fa-pencil"></i>
                Update selected points
              </button>
            </div>

            <!-- "Delete points" button -->
            <div class="form-group">
              <button class="btn btn-sm btn-danger pull-right" ng-disabled="true">
                <i class="fa fa-trash"></i>
                Delete selected points
              </button>
            </div>

          </div>
        </form>
      </div>
    </div>
  </div>
</footer>


