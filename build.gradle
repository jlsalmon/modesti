plugins {
    id "io.spring.dependency-management" version "0.6.1.RELEASE"
    id "net.researchgate.release" version "2.5.0"
}

subprojects {
    group = 'cern.modesti'

    apply plugin: "java"
    apply plugin: "maven"
    apply plugin: "maven-publish"
    apply plugin: "io.spring.dependency-management"
    apply plugin: "idea"
    apply plugin: "eclipse"

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenCentral()
        maven { url "http://artifactory/release" }
        maven { url "http://artifactory/development" }
        maven { url "https://repo.spring.io/release" }
    }

    dependencyManagement {
        applyMavenExclusions = false
    }
}

release {
    buildTasks = ['releaseBuild']
}

task releaseBuild {
    dependsOn(
            'modesti-api:build',
            'modesti-api:publish',
            'modesti-test:build',
            'modesti-test:publish',
            'modesti-server:build',
            'modesti-server:publish'
    )
}

task wrapper(type: Wrapper) {
    gradleVersion = "2.10"
}

///** Configure publishing to Artifactory */
//publishing {
//    publications {
//        mavenJava(MavenPublication) {
//            from components.java
//            pom.withXml {
//                def parentNode = asNode().appendNode('parent')
//                parentNode.appendNode('groupId', 'org.springframework.boot')
//                parentNode.appendNode('artifactId', 'spring-boot-starter-parent')
//                parentNode.appendNode('version', '1.4.2.RELEASE')
//            }
//            artifact(fatJarTar)  { classifier "dist" }
//            artifact(sourcesJar) { classifier "sources" }
//            artifact(javadocJar) { classifier "javadoc" }
//        }
//    }
//    repositories {
//        maven {
//            credentials {
//                username artifactoryUser
//                password artifactoryPassword
//            }
//
//            if (project.version.endsWith('-SNAPSHOT')) {
//                url "http://artifactory/beco-development-local"
//            } else {
//                url "http://artifactory/beco-release-local"
//            }
//        }
//    }
//}

///** Configure release options */
//release {
//    preTagCommitMessage = 'Set version before release: '
//    tagCommitMessage = 'Tagging version '
//    newVersionCommitMessage = 'Bumped version to '
//}

